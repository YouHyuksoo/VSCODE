import cv2
import socket
import struct
import pickle

# Initialize the webcam
cap = cv2.VideoCapture(0)

# Create a socket object for connecting to the server
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
host_ip = '192.168.120.239'  # Server IP address
port = 9999  # Port number used by the server

client_socket.connect((host_ip, port))  # Connect to the server

if cap.isOpened():
    while True:
        ret, frame = cap.read()
        if not ret:
            print("Failed to grab frame")
            break
        # Serialize frame
        data = pickle.dumps(frame)

        # Send message length first
        message_size = struct.pack("L", len(data))  # Unsigned long integer
        client_socket.sendall(message_size + data)

        # Break the loop if 'q' is pressed
        if cv2.waitKey(1) & 0xFF == ord('q'):
            break
else:
    print("Cannot open camera")

cap.release()
cv2.destroyAllWindows()
